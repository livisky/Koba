define("business/product_detail/0.0.1/product_detail",["common/ysDialog/0.0.1/ysDialog"],function(a){function b(a,b,c){$.ajax({type:"post",url:a,data:b,timeout:"15000",dataType:"json",success:c,error:function(){e.hint({tipText:"出错了！",timeout:2e3})}})}function c(a){var b=["<li>",'<a class="specBtn" specpic="{spec_img}" specid="{spec_id}" specvid="{specvid}" specprice="{price}" href="javascript:;">',"{param}",'<i title="点击取消选择"> </i>',"</a>","</li>"].join(""),c=b.replace(/(\{.+?\})/g,function(b){return a[b.slice(1,-1)]});return c}function d(a){var b=['<div class="specBox">','<div class="spec-pic fl">','<img height="85" src="{pro_img}">',"</div>",'<div class="spec-con fl">','<div class="pro-name">{proName}</div>','<div class="pro-price">价格：<span class="spec-price-orange"><b>￥{priceMin}-￥{priceMax}</b></span></div>','<div class="spec-list">','<div class="spec-label">配置：</div>','<div class="spec-values">',"<ul>{specList}</ul>","</div>","</div>","</div>",'<input type="hidden" id="specSubIpt" data-picinit="{pro_img}" data-priceinit="￥{priceMin}-￥{priceMax}" />',"</div>"].join(""),c=b.replace(/(\{.+?\})/g,function(b){return a[b.slice(1,-1)]});return c}var e=a("common/ysDialog/0.0.1/ysDialog"),f=$(".tab_inner_1 li").not(".cart"),g=$(".item_con"),h=$("a.toCart"),i="1"==$("#is_spec").val()||"true"==$("#is_spec").val()?!0:!1,j="/product.php/default/getspec",k="/product.php/default/addcart",l=h.attr("buy");f.click(function(){var a=$(this).index();f.removeClass("active").eq(a).addClass("active"),g.addClass("hide").eq(a).removeClass("hide")}),h.click(function(){i?b(j,{goodsId:l},function(a){if(a.status){var f=a.data.spec_info,g=[];$.each(f,function(a,b){g.push(c(b))});var h={pro_img:f[0].spec_img,pro_name:a.data.goods_name,priceMin:a.data.price_low,priceMax:a.data.price_height,specList:g.join("")};e.popup("选择规格",{ok:"提交",cancel:"取消",width:"420",html:d(h)},function(a){if(1==a)if($(".specBtn.seled").length>0){var c=$(".specBtn.seled").attr("specid");b(k,{goodsId:l,specId:c},function(a){a.status&&$(".sea-ysdialog").parent().hide().prev().hide(),e.hint({tipText:a.status?"success":a.msg,timeout:2e3})})}else e.hint({tipText:"请选择规格！",timeout:2e3})},function(){$(".specBox").click(function(a){var a=a||window.event,b=$(a.target)||$(a.srcElement),c=$(".spec-pic img"),d=$(".pro-price b"),e=$("#specSubIpt"),f=e.attr("data-picinit"),g=e.attr("data-priceinit");if(b.hasClass("specBtn")){var h=b.attr("specprice"),i=b.attr("specpic"),j=b.attr("specid"),k=b.attr("specvid");b[b.hasClass("seled")?"removeClass":"addClass"]("seled"),b.parent("li").siblings().find("a.specBtn").removeClass("seled"),b.hasClass("seled")?(c.attr("src",i),d.text("￥"+h),e.attr({"data-price":h,"data-picsrc":i,"data-specid":j,"data-specvid":k})):(c.attr("src",f),d.text(g),e.removeAttr("data-price data-picsrc data-specid data-specvid"))}})},"standBy")}else e.hint({tipText:"获取规格失败，请重试！",timeout:2e3})}):b(k,{goodsId:l},function(a){e.hint({tipText:a.status?"success":a.msg,timeout:2e3})})})});